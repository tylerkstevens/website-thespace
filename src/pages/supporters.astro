---
import { getCollection, type CollectionEntry } from "astro:content";
import Layout from "@layouts/Layout.astro";
import Container from "@components/container.astro";
import Sectionhead from "@components/sectionhead.astro";
import PricingCard from "@components/pricing.astro";

type SponsorEntry = CollectionEntry<"sponsors">;

const publishedSponsors: SponsorEntry[] = await getCollection("sponsors", ({ data }) => {
  return !data.draft && new Date(data.publishDate) <= new Date();
});

publishedSponsors.sort((a, b) => {
  const dateA = new Date(a.data.publishDate || "1970-01-01").getTime();
  const dateB = new Date(b.data.publishDate || "1970-01-01").getTime();
  return dateA - dateB;
});

const foundingSponsors = publishedSponsors.filter(sponsor => 
  new Date(sponsor.data.publishDate) <= new Date('2024-09-28')
);
const currentSponsors = publishedSponsors.filter(sponsor => 
  new Date(sponsor.data.publishDate) > new Date('2024-09-28')
);

const sponsorPlan = {
  name: "Become a Supporter",
  price: "Join The Mission",
  popular: true,
  features: [
    "Participate in our Educational Events",
    "Brand Recognition & Marketing",
    "Association with The Space",
    "Bitcoin Community Involvement",
    "Your Ideas & more..."
  ],
  button: {
    text: "Support Us",
    link: "/contact"
  }
};
---

<Layout title="Supporters">
  <Container>
    <Sectionhead>
      <Fragment slot="title">Supporters</Fragment>
      <Fragment slot="desc">
        The Space was made possible by Founding Supporters, Members, and Donors. Reach out to get involved.
      </Fragment>
    </Sectionhead>

    <!-- 1. Become a Supporter Card (Top) -->
    <div class="max-w-2xl mx-auto mt-16 mb-20 text-center">
      <PricingCard plan={sponsorPlan} />
    </div>

    <!-- 2. Current Supporters Grid (Middle) – 1 row, 4 columns -->
    {currentSponsors.length > 0 && (
      <section class="my-20">
        <h2 class="text-center text-4xl font-bold text-gray-800 mb-12">
          Current Supporters
        </h2>
        <div class="supporters-grid-4col">
          {currentSponsors.map((sponsor) => (
            <a href={sponsor.data.url} target="_blank" rel="noopener noreferrer" class="flex justify-center">
              <img
                src={sponsor.data.avatar?.src || "/default-event-image.webp"}
                alt={sponsor.data.avatar?.alt || `${sponsor.data.title} logo`}
                class="sponsor-logo-4col rounded-full object-contain"
                loading="lazy"
              />
            </a>
          ))}
        </div>
      </section>
    )}

    <!-- 3. Founding Supporters Grid (Bottom) – 1 row, 4 columns -->
    {foundingSponsors.length > 0 && (
      <section class="my-20">
        <h2 class="text-center text-4xl font-bold text-gray-800 mb-12">
          Founding Supporters
        </h2>
        <div class="supporters-grid-4col">
          {foundingSponsors.map((sponsor) => (
            <a href={sponsor.data.url} target="_blank" rel="noopener noreferrer" class="flex justify-center">
              <img
                src={sponsor.data.avatar?.src || "/default-event-image.webp"}
                alt={sponsor.data.avatar?.alt || `${sponsor.data.title} logo`}
                class="sponsor-logo-4col rounded-full object-contain"
                loading="lazy"
              />
            </a>
          ))}
        </div>
      </section>
    )}
  </Container>
</Layout>

<style>
  /* Unified 4-column grid (1 row on large screens) */
  .supporters-grid-4col {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 4rem;
    justify-items: center;
    align-items: center;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
  }

  .sponsor-logo-4col {
    width: 180px;
    height: 180px;
    transition: transform 0.3s ease;
  }

  .sponsor-logo-4col:hover {
    transform: scale(1.1);
  }

  /* Tablet – 2 columns */
  @media (max-width: 1024px) {
    .supporters-grid-4col {
      grid-template-columns: repeat(2, 1fr);
      gap: 3rem;
    }
    .sponsor-logo-4col {
      width: 140px;
      height: 140px;
    }
  }

  /* Mobile – 2 columns, smaller logos */
  @media (max-width: 640px) {
    .supporters-grid-4col {
      grid-template-columns: repeat(2, 1fr);
      gap: 2rem;
    }
    .sponsor-logo-4col {
      width: 100px;
      height: 100px;
    }
  }
</style>